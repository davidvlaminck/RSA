from DQReport import DQReport


class Report0107:
    def __init__(self):
        self.report = None

    def init_report(self):
        self.report = DQReport(name='report0107', title='Geometrie is geldig: in Vlaanderen gelegen',
                               spreadsheet_id='1aUVoYhqKe1k4KwuAyNcfWXkH9uwj1Cls_ufH2j37gNg', datasource='PostGIS',
                               persistent_column='C')

        self.report.result_query = """
        WITH cte_bbox_vlaanderen (geom) AS (
            values(
                ST_SetSRID(ST_GeomFromText(
                -- Bounding box rondom Vlaaanderen met een 1 km buffer en coordinaten gegeneraliseerd tot op 500 meter
                '
                MULTIPOLYGON (((255282.7850774172 156375.055590438,251371.83939070432 156165.1426476895,249346.60660163657 159628.52820601102,245639.72015531088 159268.68712967477,242792.90749494842 159920.49527955716,241583.30112968409 161838.94222264923,242184.61674769994 162601.79426542463,246053.53241408092 163198.50918002,248836.21292721236 165558.89027462216,250208.62797480062 165468.18668972718,250412.0995931089 164180.99185315432,251950.9976235331 162754.90961919367,254171.28233922448 163796.09910754423,257840.15898875872 164079.2741050991,259858.29125762836 159046.6912610227,257744.1432251968 155805.398149018,255282.7850774172 156375.055590438)),((191308.31443301696 239032.10965931162,191562.13439299024 237245.3177450141,190762.04022907626 235711.27725270507,193229.6986773734 237903.32796010908,193704.8052252616 240929.93485190292,195732.20808252972 243148.5862114345,197108.75278404736 243079.021472887,197697.31863570763 241387.76297251516,200076.00074669623 241143.1176923848,202194.65170968726 236152.51486723596,200094.38200108713 231918.11072466863,203976.08598250675 227241.39921202883,204332.04891601112 223899.97139839822,208208.98051237053 225007.87701942626,211724.10829473234 222732.56068813597,210983.49625791406 218358.9864298171,216951.91544410156 218474.6191808076,218145.90028140298 219931.87851099827,222814.43542801752 218631.09829371359,227360.6054449391 222781.57218912223,230483.05240782446 222125.5382792465,233957.81967646073 218140.48729456315,234145.111538808 213881.05910420232,239769.35938236993 211650.50811811956,240854.47810005047 210240.08554900726,246782.22128121447 210706.9287091327,249352.20824595928 209094.55652824583,249620.20062989998 207395.01776754324,252203.83837311278 208384.27789104945,255055.41183324845 205421.14779556709,253838.7923389068 202759.55729091243,252138.52376153224 201773.88629394682,253413.1462762996 200878.02996118297,253434.66599423683 199181.55959161697,251521.11092036852 198080.41546550163,251198.2616774266 194964.02309746947,249364.04276973222 194303.69813030175,248771.14186384232 192731.1512169508,249752.9105090559 191400.2500851271,249155.8588646486 188368.3068283332,246892.72435720993 185377.47666646092,248284.36464446998 184538.6997314399,248597.98104714413 182908.91922040677,245954.0932199631 177819.7020317232,244421.33750059438 177459.55727992253,242705.256503804 174267.39909395584,241765.1999074741 174289.33308287896,240800.6234667716 173118.1346863106,241354.8930960506 169770.57524703073,243926.42298271606 168117.10162095845,243698.9237952643 166091.22832816007,241349.66852864015 165846.72399216134,237979.40405253848 162475.3579114888,232671.15955904013 160518.328322258,232488.39510146528 159183.01076524027,228864.50569752388 156628.7849733043,224057.97559905055 155982.40189525796,221397.12520329136 158506.41429439533,219729.50903458777 159027.4671188831,216606.37186317507 155585.55531834485,214378.77163024302 156554.68737668448,213130.18444506673 155431.03950591694,209229.79014528036 155966.43077867787,206496.71383341055 153137.80308232273,204984.39211819178 153155.5060152133,202502.06917921253 154507.09684263408,201474.38345857046 153986.50211711435,198953.05923009518 154490.372997489,196794.57063989443 156543.90735406862,196561.74319188413 158491.11804609347,194237.634046984 160906.22357486968,188771.70681892664 158303.7795307778,187309.13330385412 159205.38372301872,186957.57965044086 160537.9141003414,182183.56230905087 160715.45609083716,179292.64963751863 164513.53788118757,176967.94756904678 165128.11834657434,174895.80028273133 163321.12843019213,170639.1586181031 163722.88708228155,170145.95881500238 162573.7870205889,171160.3350863078 160103.42810492544,169478.86858671682 158326.17691300568,166246.49091125187 158024.69868413016,165328.0664422306 158939.18104151485,163065.34642403122 158443.85226101082,160800.57851591043 156409.42707211795,156707.89874631685 159244.23312523644,154351.8047563209 157468.4903559313,151253.49428448244 156866.4969373501,150624.4604307654 155138.8100278219,146903.12046784328 154993.76802053978,146452.47841234104 153736.04290701088,144598.60812653406 152692.5987494124,142802.20617327405 153252.74759095957,140774.41092447605 152343.0041727352,138362.40168900535 154338.18767546953,136122.48004666422 154222.41449146724,135029.37780092296 156183.53220675202,131086.69913191732 153987.09047705866,129583.40210996143 154575.73076495883,128365.91325864864 152773.24155159647,127180.15677197228 153276.2745259231,124523.14723391611 152974.47908426935,123508.31701451953 152087.3266622576,119094.05044747 152211.32143012597,117174.2436764918 152617.7201812913,115300.33508140189 155123.97054034562,115309.18861503847 158894.91938905558,112227.70691177835 158099.15210594077,110241.76102844861 159106.37234846878,107838.32297380698 158859.68575282532,106041.03684501487 161530.9367094607,103809.89604903081 161134.76070601295,102442.95957630344 161756.90045148853,99741.6057787441 158404.71437398388,99359.24157735087 156425.21259370816,97813.21423563936 155952.1324052279,95907.82384829433 157179.1537185672,93205.92801406876 156815.60506261035,91033.06998048435 157527.02880916887,90541.06909809065 160622.95731864477,88534.25249799338 160144.84228183128,86316.75903272202 160727.7548953811,82899.45051187206 158918.8573746627,81679.89186597052 157206.7915996504,80228.2932006131 156963.94105847643,78842.01450847172 154819.28966825365,75289.13387858355 156816.81894913816,74703.57951359147 159631.68642590905,71934.19203132225 159594.05476190182,69136.50344109064 161166.80131723935,67253.99419586448 160163.1833238367,65457.03757166637 160301.3450956437,63258.93707726841 163896.2831206795,61818.66573013242 163863.49937631068,59796.201478603674 162280.49364605802,57600.26173228401 163108.49162020494,56245.0027868044 162077.5649636992,54832.01297172242 162178.2764774937,53878.88713489486 162898.9698612914,53143.652893774524 166197.86154909397,51099.74716552779 165271.60989589774,51670.276254314536 163119.4333391869,48960.66428706547 161925.69310333312,48277.13451763318 160603.47152212667,43784.656640175344 160625.8899194404,43611.82120476932 159122.7079215286,45157.29242454528 156586.35556723573,43883.01975742823 155337.90895275027,42099.59589254883 156779.91975979175,40090.12569964286 156256.4345786438,37733.746028374975 157718.10930222535,36954.617997222165 160520.22762830762,33323.997841512806 165288.67430785252,32897.5469486595 167315.85498156873,27550.62288784041 167357.18926465028,26302.732850505785 170285.01248485985,24312.381520174516 172201.22276307852,25225.998248304215 174318.64103521788,24874.477129630213 178784.48218770296,23976.22082020809 180466.58424832186,26709.265815377137 183688.8911939501,25236.048270976866 187395.8075982527,22973.017833710837 189636.23527470743,22396.869688931398 196349.52647332705,20902.103162216772 199692.15878767456,21200.80313690953 200514.59234867667,25983.970534074277 202847.98100969885,26344.640705185935 203858.92435348648,37007.776275484706 208723.11866051337,46924.31866107615 215259.73493314922,47652.8291787715 216427.59479942956,49702.83451855426 216869.74065590024,59538.93434353055 223420.8996825212,64773.377426416424 225725.58787564444,65597.83216460013 226652.89500348727,65180.96164182984 227845.93862319956,67217.86254293821 229670.11007750191,70248.09562679908 229475.65179435315,72235.56373627647 228059.09486054708,80691.07089008627 230556.1162888421,82484.50224299447 225302.95087887655,80901.58937644312 223271.22776615876,82160.70120558151 221445.5859057919,81559.14144214679 221102.8052298042,82122.67312019742 219422.0965496961,85949.62671831978 216028.44099594813,90129.47766304837 216368.51325500238,89845.66956364897 220920.3372787355,94266.39097556898 221841.74207873986,95838.20882060257 223142.92785386308,99127.83975069842 221255.53627942022,100850.16084478775 221186.65027865604,104323.1643350239 219235.90247078513,107009.96492257538 219086.33248843907,110725.1776552531 217174.4632800538,110563.07564401494 212633.66297996233,114313.19078099875 212528.27850851425,116273.72510839374 213733.78608807115,117745.78651095799 212549.98157959784,118880.00296824821 213416.9590877974,120715.33502192504 212889.72317587383,125013.38214806184 216050.28871358174,127840.08373032403 215795.7187391865,135176.62269774723 221099.56489386945,139691.10593402994 226869.8268482694,138384.5473697164 229564.91211256184,138943.13686342924 230331.96316949016,147946.55814009556 230779.00330752492,148864.79852101352 228656.00888095426,151367.84319220379 228282.01178010562,152922.70529965998 229095.11293860798,149988.49386908792 234529.1093780414,150724.50246337574 236407.84606156682,150029.0233798581 236644.370127639,149871.71407945044 238058.04168945667,157109.2147655862 241904.28580461635,162429.8291560777 242241.60398320382,163483.96386307772 240238.69618719604,162230.48123827932 237609.42063026596,162404.206724787 236234.807598735,164368.62317939903 236938.7656422827,169818.7153826835 236271.0441448111,169953.63858881846 237960.45263998405,171877.21035469632 238989.57324627807,175937.76945459697 244131.25352737127,178203.29407989667 245104.26540585776,181280.9999136701 243984.59613999282,182236.75773313554 242484.4781287829,183801.6374438395 241813.8741611932,184091.48640631582 238801.61275917583,182755.91268608303 236699.46515782588,183917.62942304532 235005.739881293,186971.8764005913 236041.69461418877,187451.84766551715 238192.75496948845,189469.16760630195 239631.6361973343,191308.31443301696 239032.10965931162),(187277.65776067096 235577.9599685435,188193.37594136893 234234.9986225117,190047.98462721638 234872.87882957933,188645.89749629132 234670.61050793904,187277.65776067096 235577.9599685435)))
                '
                ), 31370)
            )
        ), cte_asset_withGeom as (
            select a.uuid, g.wkt_string, st_setsrid(st_geomfromtext(g.wkt_string), 31370) as geom 
            from assets a
            left join geometrie g on a.uuid = g.assetuuid
            where
                a.actief = true
                and
                g.wkt_string is not null
        )
        select
            a.uuid
            , left(a.wkt_string, 50000) as wkt_string
        FROM cte_asset_withGeom a
        left join cte_bbox_vlaanderen bbox on st_within(a.geom, bbox.geom) where bbox.geom is null;

	"""

    def run_report(self, sender):
        self.report.run_report(sender=sender)
