from DQReport import DQReport


class Report0107:
    def __init__(self):
        self.report = None

    def init_report(self):
        self.report = DQReport(name='report0107', title='Geometrie is geldig: in Vlaanderen gelegen',
                               spreadsheet_id='1aUVoYhqKe1k4KwuAyNcfWXkH9uwj1Cls_ufH2j37gNg', datasource='PostGIS',
                               persistent_column='C')

        self.report.result_query = """
        WITH cte_bbox_vlaanderen (geom) AS (
            values(
                ST_SetSRID(ST_GeomFromText(
                -- Bounding box rondom Vlaaanderen met een 1 km buffer en coordinaten gegeneraliseerd tot op 500 meter
                '
                MultiPolygon (((255282.78507742 156375.05559044, 251371.8393907 156165.14264769, 249346.60660164 159628.52820601, 245639.72015531 159268.68712967, 242792.90749495 159920.49527956, 241583.30112968 161838.94222265, 242184.6167477 162601.79426542, 246053.53241408 163198.50918002, 248836.21292721 165558.89027462, 250208.6279748 165468.18668973, 250412.09959311 164180.99185315, 251950.99762353 162754.90961919, 254171.28233922 163796.09910754, 257840.15898876 164079.2741051, 259858.29125763 159046.69126102, 257744.1432252 155805.39814902, 255282.78507742 156375.05559044)),((191308.31443302 239032.10965931, 191562.13439299 237245.31774501, 190762.04022908 235711.27725271, 193229.69867737 237903.32796011, 193704.80522526 240929.9348519, 195732.20808253 243148.58621143, 197108.75278405 243079.02147289, 197697.31863571 241387.76297252, 200076.0007467 241143.11769238, 202194.65170969 236152.51486724, 200094.38200109 231918.11072467, 203976.08598251 227241.39921203, 204332.04891601 223899.9713984, 208208.98051237 225007.87701943, 211724.10829473 222732.56068814, 210983.49625791 218358.98642982, 216951.9154441 218474.61918081, 218145.9002814 219931.878511, 222814.43542802 218631.09829371, 227360.60544494 222781.57218912, 230483.05240782 222125.53827925, 233957.81967646 218140.48729456, 234145.11153881 213881.0591042, 239769.35938237 211650.50811812, 240854.47810005 210240.08554901, 246782.22128121 210706.92870913, 249352.20824596 209094.55652825, 249620.2006299 207395.01776754, 252203.83837311 208384.27789105, 255055.41183325 205421.14779557, 253838.79233891 202759.55729091, 252138.52376153 201773.88629395, 253413.1462763 200878.02996118, 253434.66599424 199181.55959162, 251521.11092037 198080.4154655, 251198.26167743 194964.02309747, 249364.04276973 194303.6981303, 248771.14186384 192731.15121695, 249752.91050906 191400.25008513, 249155.85886465 188368.30682833, 246892.72435721 185377.47666646, 248284.36464447 184538.69973144, 248597.98104714 182908.91922041, 245954.09321996 177819.70203172, 244421.33750059 177459.55727992, 242705.2565038 174267.39909396, 241765.19990747 174289.33308288, 240800.62346677 173118.13468631, 241354.89309605 169770.57524703, 243926.42298272 168117.10162096, 243698.92379526 166091.22832816, 241349.66852864 165846.72399216, 237979.40405254 162475.35791149, 232671.15955904 160518.32832226, 232488.39510147 159183.01076524, 228864.50569752 156628.7849733, 224057.97559905 155982.40189526, 221397.12520329 158506.4142944, 219729.50903459 159027.46711888, 216606.37186318 155585.55531834, 214378.77163024 156554.68737668, 213130.18444507 155431.03950592, 209229.79014528 155966.43077868, 209081.91375844 153232.94013121, 206496.71383341 153137.80308232, 204984.39211819 153155.50601521, 202502.06917921 154507.09684263, 201474.38345857 153986.50211711, 198953.0592301 154490.37299749, 196794.57063989 156543.90735407, 196561.74319188 158491.11804609, 194237.63404698 160906.22357487, 188771.70681893 158303.77953078, 187309.13330385 159205.38372302, 186957.57965044 160537.91410034, 182183.56230905 160715.45609084, 179292.64963752 164513.53788119, 176967.94756905 165128.11834657, 174895.80028273 163321.12843019, 170639.1586181 163722.88708228, 170145.958815 162573.78702059, 171160.33508631 160103.42810493, 169478.86858672 158326.17691301, 166246.49091125 158024.69868413, 165328.06644223 158939.18104151, 163065.34642403 158443.85226101, 160800.57851591 156409.42707212, 156707.89874632 159244.23312524, 154351.80475632 157468.49035593, 151253.49428448 156866.49693735, 150624.46043077 155138.81002782, 146903.12046784 154993.76802054, 146452.47841234 153736.04290701, 144598.60812653 152692.59874941, 142802.20617327 153252.74759096, 140774.41092448 152343.00417274, 138362.40168901 154338.18767547, 136122.48004666 154222.41449147, 135029.37780092 156183.53220675, 131086.69913192 153987.09047706, 129583.40210996 154575.73076496, 128365.91325865 152773.2415516, 127180.15677197 153276.27452592, 124523.14723392 152974.47908427, 123508.31701452 152087.32666226, 119094.05044747 152211.32143013, 117174.24367649 152617.72018129, 115300.3350814 155123.97054035, 115309.18861504 158894.91938906, 112227.70691178 158099.15210594, 110241.76102845 159106.37234847, 107838.32297381 158859.68575283, 106041.03684501 161530.93670946, 103809.89604903 161134.76070601, 102442.9595763 161756.90045149, 99741.60577874 158404.71437398, 99359.24157735 156425.21259371, 97813.21423564 155952.13240523, 95907.82384829 157179.15371857, 93205.92801407 156815.60506261, 91033.06998048 157527.02880917, 90541.06909809 160622.95731864, 88534.25249799 160144.84228183, 86316.75903272 160727.75489538, 82899.45051187 158918.85737466, 81679.89186597 157206.79159965, 80228.29320061 156963.94105848, 78842.01450847 154819.28966825, 75289.13387858 156816.81894914, 74643.84812965 157305.56266345, 73937.97302636 157630.8188385, 71934.19203132 159594.0547619, 69136.50344109 161166.80131724, 67253.99419586 160163.18332384, 65457.03757167 160301.34509564, 63258.93707727 163896.28312068, 61818.66573013 163863.49937631, 59796.2014786 162280.49364606, 57600.26173228 163108.4916202, 56245.0027868 162077.5649637, 54832.01297172 162178.27647749, 53878.88713489 162898.96986129, 53143.65289377 166197.86154909, 51099.74716553 165271.6098959, 51670.27625431 163119.43333919, 48960.66428707 161925.69310333, 48277.13451763 160603.47152213, 43784.65664018 160625.88991944, 43611.82120477 159122.70792153, 45157.29242455 156586.35556724, 43883.01975743 155337.90895275, 42099.59589255 156779.91975979, 40090.12569964 156256.43457864, 37733.74602837 157718.10930223, 36954.61799722 160520.22762831, 33323.99784151 165288.67430785, 32897.54694866 167315.85498157, 27550.62288784 167357.18926465, 26302.73285051 170285.01248486, 24312.38152017 172201.22276308, 25225.9982483 174318.64103522, 24874.47712963 178784.4821877, 23976.22082021 180466.58424832, 26709.26581538 183688.89119395, 25236.04827098 187395.80759825, 22973.01783371 189636.23527471, 22396.86968893 196349.52647333, 20902.10316222 199692.15878767, 21200.80313691 200514.59234868, 25983.97053407 202847.9810097, 26344.64070519 203858.92435349, 37007.77627548 208723.11866051, 46924.31866108 215259.73493315, 47652.82917877 216427.59479943, 49702.83451855 216869.7406559, 59538.93434353 223420.89968252, 64773.37742642 225725.58787564, 65597.8321646 226652.89500349, 65180.96164183 227845.9386232, 67217.86254294 229670.1100775, 70248.0956268 229475.65179435, 72235.56373628 228059.09486055, 80691.07089009 230556.11628884, 82484.50224299 225302.95087888, 80901.58937644 223271.22776616, 82160.70120558 221445.58590579, 81559.14144215 221102.8052298, 82122.6731202 219422.0965497, 85949.62671832 216028.44099595, 90129.47766305 216368.513255, 89845.66956365 220920.33727874, 94266.39097557 221841.74207874, 95838.2088206 223142.92785386, 99127.8397507 221255.53627942, 100850.16084479 221186.65027866, 104323.16433502 219235.90247079, 107009.96492258 219086.33248844, 110725.17765525 217174.46328005, 110563.07564401 212633.66297996, 114313.190781 212528.27850851, 116273.72510839 213733.78608807, 117745.78651096 212549.9815796, 118880.00296825 213416.9590878, 120715.33502193 212889.72317587, 125013.38214806 216050.28871358, 127840.08373032 215795.71873919, 135176.62269775 221099.56489387, 139691.10593403 226869.82684827, 138384.54736972 229564.91211256, 138943.13686343 230331.96316949, 147946.5581401 230779.00330752, 148864.79852101 228656.00888095, 151367.8431922 228282.01178011, 152922.70529966 229095.11293861, 149988.49386909 234529.10937804, 150724.50246338 236407.84606157, 150029.02337986 236644.37012764, 149871.71407945 238058.04168946, 157109.21476559 241904.28580462, 162429.82915608 242241.6039832, 163483.96386308 240238.6961872, 162230.48123828 237609.42063027, 162404.20672479 236234.80759874, 164368.6231794 236938.76564228, 169818.71538268 236271.04414481, 169953.63858882 237960.45263998, 171877.2103547 238989.57324628, 175937.7694546 244131.25352737, 178203.2940799 245104.26540586, 181280.99991367 243984.59613999, 182236.75773314 242484.47812878, 183801.63744384 241813.87416119, 184091.48640632 238801.61275918, 182755.91268608 236699.46515783, 183917.62942305 235005.73988129, 186971.87640059 236041.69461419, 187451.84766552 238192.75496949, 189469.1676063 239631.63619733, 191308.31443302 239032.10965931),(187277.65776067 235577.95996854, 188193.37594137 234234.99862251, 190047.98462722 234872.87882958, 188645.89749629 234670.61050794, 187277.65776067 235577.95996854)))
                '
                ), 31370)
            )
        ), cte_asset_withGeom as (
            select a.uuid, g.wkt_string, st_setsrid(st_geomfromtext(g.wkt_string), 31370) as geom 
            from assets a
            left join geometrie g on a.uuid = g.assetuuid
            where
                a.actief = true
                and
                g.wkt_string is not null
        )
        select
            a.uuid
            , left(a.wkt_string, 50000) as wkt_string
        FROM cte_asset_withGeom a
        left join cte_bbox_vlaanderen bbox on st_within(a.geom, bbox.geom) where bbox.geom is null;
	"""

    def run_report(self, sender):
        self.report.run_report(sender=sender)
